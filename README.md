# Stripe Demo Merchant Store

This repository provides a minimal single-product merchant experience that uses Stripe Payment Intents with an embedded Stripe Elements form and a Spring Boot backend. It is
intended for testing EnsureBack integrations with a realistic checkout and order logging flow.

## Project structure

```
/backend   # Spring Boot API and Stripe webhooks
/frontend  # React + Tailwind storefront
```

## Prerequisites

- Java 17+
- Maven 3.9+
- Node.js 18+
- npm or yarn
- Stripe CLI (for local webhook testing)

## Environment configuration

Copy the example environment file and fill in your Stripe test credentials:

```bash
cp .env.example .env
```

Set the following values:

- `STRIPE_SECRET_KEY`: your Stripe test secret key (`sk_test_*`)
- `STRIPE_WEBHOOK_SECRET`: generated by the Stripe CLI when forwarding webhooks
- `FRONTEND_URL`: base URL for the React app (defaults to `http://localhost:5173`)
- `VITE_STRIPE_PUBLISHABLE_KEY`: your Stripe test publishable key (`pk_test_*`) for the React frontend

The Spring Boot application and React frontend read these variables automatically during development.

## Running the backend

```bash
cd backend
mvn spring-boot:run
```

The API listens on `http://localhost:8080` and exposes:

- `POST /api/payments/create-intent` → create a Payment Intent for the headphones product and return the client secret
- `POST /api/orders` → record order details after the frontend confirms payment
- `GET /api/orders` → retrieve logged orders from the H2 database
- `POST /webhook` → Stripe webhook handler for succeeded and failed payment intents

## Running the frontend

```bash
cd frontend
npm install
npm run dev
```

The storefront is available at `http://localhost:5173` and proxies API calls to the backend during development.

## Stripe webhook forwarding

Run the Stripe CLI in a separate terminal to forward events to your local backend:

```bash
stripe listen --forward-to localhost:8080/webhook
```

Use the Stripe test card `4242 4242 4242 4242` with any future expiry date and CVC `123` to simulate successful
payments.

## Building for production

To produce optimized assets for the storefront:

```bash
cd frontend
npm run build
```

To package the backend:

```bash
cd backend
mvn package
```

## Order lifecycle

1. The React storefront calls `POST /api/payments/create-intent` when the shopper clicks **Pay Now** and receives a Payment Intent client secret.
2. Stripe Elements confirms the card payment inline via `stripe.confirmCardPayment`.
3. After a successful confirmation, the frontend posts to `POST /api/orders` so the backend logs the order with its Payment Intent ID.
4. Stripe webhooks mark orders as `PAID` or `FAILED`, and the success page polls `GET /api/orders` to display the final order status to the shopper.
